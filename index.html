<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>加密封存</title>
    <style>html,
body {
    width: 100%;
    height: 100%;
}

body,
div {
    padding: 0px;
    margin: 0px;
}

#main-page {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
}

#text-wrap {
    background-color: gray;
    flex-basis: auto;
    flex-grow: 1;
    position: relative;
}

#text {
    margin: 0px;
    width: 100%;
    height: 100%;
    box-sizing: border-box;
    resize: none;
    padding: 0.2em 0.4em;
}

.popup {
    display: flex;
    position: fixed;
    left: 0px;
    top: 0px;
    width: 100%;
    height: 100%;
    background-color: gray;
    z-index: 100;
    align-items: center;
    justify-content: center;
}

.panel {
    display: inline-block;
    background-color: white;
    padding: 10px;
    border: 1px solid gray;
    border-radius: 5px;
}

.al-r {
    text-align: right;
}

.hide {
    display: none;
}
</style>
</head>
<body>
    <div id="main-page">
        <div id="toolbar">
            <img id="btn-archive" class="icon" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNiIgaGVpZ2h0PSIzNiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJsdWNpZGUgbHVjaWRlLWZpbGUtYXJjaGl2ZS1pY29uIGx1Y2lkZS1maWxlLWFyY2hpdmUiPjxwYXRoIGQ9Ik0xMCAxMnYtMSIvPjxwYXRoIGQ9Ik0xMCAxOHYtMiIvPjxwYXRoIGQ9Ik0xMCA3VjYiLz48cGF0aCBkPSJNMTQgMnY0YTIgMiAwIDAgMCAyIDJoNCIvPjxwYXRoIGQ9Ik0xNS41IDIySDE4YTIgMiAwIDAgMCAyLTJWN2wtNS01SDZhMiAyIDAgMCAwLTIgMnYxNmEyIDIgMCAwIDAgLjI3NCAxLjAxIi8+PGNpcmNsZSBjeD0iMTAiIGN5PSIyMCIgcj0iMiIvPjwvc3ZnPg==" title="封存成自帶解密程式的HTML">
            <img id="btn-save" class="icon" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNiIgaGVpZ2h0PSIzNiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJsdWNpZGUgbHVjaWRlLWZpbGUtbG9jazItaWNvbiBsdWNpZGUtZmlsZS1sb2NrLTIiPjxwYXRoIGQ9Ik00IDIyaDE0YTIgMiAwIDAgMCAyLTJWN2wtNS01SDZhMiAyIDAgMCAwLTIgMnYxIi8+PHBhdGggZD0iTTE0IDJ2NGEyIDIgMCAwIDAgMiAyaDQiLz48cmVjdCB3aWR0aD0iOCIgaGVpZ2h0PSI1IiB4PSIyIiB5PSIxMyIgcng9IjEiLz48cGF0aCBkPSJNOCAxM3YtMmEyIDIgMCAxIDAtNCAwdjIiLz48L3N2Zz4=" title="匯出加密的 JSON">
            <img id="btn-load" class="icon" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNiIgaGVpZ2h0PSIzNiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJsdWNpZGUgbHVjaWRlLWZpbGUta2V5Mi1pY29uIGx1Y2lkZS1maWxlLWtleS0yIj48cGF0aCBkPSJNNCAyMmgxNGEyIDIgMCAwIDAgMi0yVjdsLTUtNUg2YTIgMiAwIDAgMC0yIDJ2NiIvPjxwYXRoIGQ9Ik0xNCAydjRhMiAyIDAgMCAwIDIgMmg0Ii8+PGNpcmNsZSBjeD0iNCIgY3k9IjE2IiByPSIyIi8+PHBhdGggZD0ibTEwIDEwLTQuNSA0LjUiLz48cGF0aCBkPSJtOSAxMSAxIDEiLz48L3N2Zz4=" title="匯入加密的 JSON">
        </div>
        <div id="text-wrap">
            <textarea id="text"></textarea>
        </div>
    </div>
    <div id="popup" class="popup hide">
        <div class="panel hide" id="panel1">
            <p>
                輸入密碼：
                <input type="password" id="pwd">
            </p>
            <p>
                再次輸入：
                <input type="password" id="pwd2">
            </p>
            <p class="al-r">
                <input type="button" id="btn-encrypt" value="確認">
                <input type="button" class="cancel" value="取消">
            </p>
        </div>
        <div class="panel hide" id="panel2">
            <p>
                選擇檔案
                <input type="file" id="file">
            </p>
            <p>
                輸入密碼
                <input type="password" id="pwd3">
            </p>
            <p class="al-r">
                <input type="button" id="btn-decrypt" value="解密">
                <input type="button" class="cancel" value="取消">
            </p>
        </div>
        <div class="panel hide" id="panel3">
            <p>
                輸入密碼
                <input type="password" id="pwd4">
            </p>
            <p id="dec-log"></p>
            <p class="al-r">
                <input type="button" id="btn-decrypt2" value="解密">
            </p>
        </div>
    </div>
    <script>
        window.cipher = null;
    </script>
    <script>!function(){"use strict";const e=new Uint8Array(64),r=new Uint8Array(123);r.fill(255);for(let t=0;t<64;++t){let n=t;n+=n<52?n<26?65:71:n<62?-4:62===n?-19:-16,e[t]=n,r[n]=t}function t(r){const t=e;if(r instanceof ArrayBuffer&&(r=new Uint8Array(r)),!r instanceof Uint8Array)throw new TypeError("參數應為 ArrayBuffer 或 Uint8Array");let n,a=r.byteLength,o=new Uint8Array(4*((a+2)/3|0)),i=0;for(let e=0;e<a;++e){if(n=r[e],o[i++]=t[n>>>2],++e>=a){o[i++]=t[n<<4&63],o[i++]=61,o[i++]=61;break}if(n=1023&(n<<8|r[e]),o[i++]=t[n>>>4],++e>=a){o[i++]=t[n<<2&63],o[i++]=61;break}n=4095&(n<<8|r[e]),o[i++]=t[n>>>6],o[i++]=t[63&n]}return(new TextDecoder).decode(o)}function n(e){const t=r;let n,a,o=e.length;for(let r=0;r<4;++r)o>0&&61===e.charCodeAt(o-1)&&--o;let i=0,l=new Uint8Array(3*(o>>>2)+((3&o)>1?(3&o)-1:0));for(let r=0;r<o;++r){if(a=e.charCodeAt(r),255===(a=a<123?t[a]:255))throw"base64 編碼錯誤";if(n=a,++r>=o)throw"base64 編碼錯誤";if(a=e.charCodeAt(r),255===(a=a<123?t[a]:255))throw"base64 編碼錯誤";if(n=n<<6|a,l[i++]=n>>>4,++r>=o)break;if(a=e.charCodeAt(r),255===(a=a<123?t[a]:255))throw"base64 編碼錯誤";if(n=1023&(n<<6|a),l[i++]=n>>>2,++r>=o)break;if(a=e.charCodeAt(r),255===(a=a<123?t[a]:255))throw"base64 編碼錯誤";n=255&(n<<6|a),l[i++]=n}return l}var a=Uint8Array,o=Uint16Array,i=Int32Array,l=new a([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),c=new a([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),f=new a([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),u=function(e,r){for(var t=new o(31),n=0;n<31;++n)t[n]=r+=1<<e[n-1];var a=new i(t[30]);for(n=1;n<30;++n)for(var l=t[n];l<t[n+1];++l)a[l]=l-t[n]<<5|n;return{b:t,r:a}},d=u(l,2),s=d.b,v=d.r;s[28]=258,v[258]=28;for(var w=u(c,0),h=w.b,y=w.r,m=new o(32768),p=0;p<32768;++p){var g=(43690&p)>>1|(21845&p)<<1;g=(61680&(g=(52428&g)>>2|(13107&g)<<2))>>4|(3855&g)<<4,m[p]=((65280&g)>>8|(255&g)<<8)>>1}var b=function(e,r,t){for(var n=e.length,a=0,i=new o(r);a<n;++a)e[a]&&++i[e[a]-1];var l,c=new o(r);for(a=1;a<r;++a)c[a]=c[a-1]+i[a-1]<<1;if(t){l=new o(1<<r);var f=15-r;for(a=0;a<n;++a)if(e[a])for(var u=a<<4|e[a],d=r-e[a],s=c[e[a]-1]++<<d,v=s|(1<<d)-1;s<=v;++s)l[m[s]>>f]=u}else for(l=new o(n),a=0;a<n;++a)e[a]&&(l[a]=m[c[e[a]-1]++]>>15-e[a]);return l},S=new a(288);for(p=0;p<144;++p)S[p]=8;for(p=144;p<256;++p)S[p]=9;for(p=256;p<280;++p)S[p]=7;for(p=280;p<288;++p)S[p]=8;var A=new a(32);for(p=0;p<32;++p)A[p]=5;var k=b(S,9,0),q=b(S,9,1),M=b(A,5,0),x=b(A,5,1),E=function(e){for(var r=e[0],t=1;t<e.length;++t)e[t]>r&&(r=e[t]);return r},U=function(e,r,t){var n=r/8|0;return(e[n]|e[n+1]<<8)>>(7&r)&t},C=function(e,r){var t=r/8|0;return(e[t]|e[t+1]<<8|e[t+2]<<16)>>(7&r)},L=function(e){return(e+7)/8|0},T=function(e,r,t){return(null==t||t>e.length)&&(t=e.length),new a(e.subarray(r,t))},O=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],D=function(e,r,t){var n=new Error(r||O[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,D),!t)throw n;return n},G=function(e,r,t){t<<=7&r;var n=r/8|0;e[n]|=t,e[n+1]|=t>>8},R=function(e,r,t){t<<=7&r;var n=r/8|0;e[n]|=t,e[n+1]|=t>>8,e[n+2]|=t>>16},B=function(e,r){for(var t=[],n=0;n<e.length;++n)e[n]&&t.push({s:n,f:e[n]});var i=t.length,l=t.slice();if(!i)return{t:N,l:0};if(1==i){var c=new a(t[0].s+1);return c[t[0].s]=1,{t:c,l:1}}t.sort((function(e,r){return e.f-r.f})),t.push({s:-1,f:25001});var f=t[0],u=t[1],d=0,s=1,v=2;for(t[0]={s:-1,f:f.f+u.f,l:f,r:u};s!=i-1;)f=t[t[d].f<t[v].f?d++:v++],u=t[d!=s&&t[d].f<t[v].f?d++:v++],t[s++]={s:-1,f:f.f+u.f,l:f,r:u};var w=l[0].s;for(n=1;n<i;++n)l[n].s>w&&(w=l[n].s);var h=new o(w+1),y=F(t[s-1],h,0);if(y>r){n=0;var m=0,p=y-r,g=1<<p;for(l.sort((function(e,r){return h[r.s]-h[e.s]||e.f-r.f}));n<i;++n){var b=l[n].s;if(!(h[b]>r))break;m+=g-(1<<y-h[b]),h[b]=r}for(m>>=p;m>0;){var S=l[n].s;h[S]<r?m-=1<<r-h[S]++-1:++n}for(;n>=0&&m;--n){var A=l[n].s;h[A]==r&&(--h[A],++m)}y=r}return{t:new a(h),l:y}},F=function(e,r,t){return-1==e.s?Math.max(F(e.l,r,t+1),F(e.r,r,t+1)):r[e.s]=t},K=function(e){for(var r=e.length;r&&!e[--r];);for(var t=new o(++r),n=0,a=e[0],i=1,l=function(e){t[n++]=e},c=1;c<=r;++c)if(e[c]==a&&c!=r)++i;else{if(!a&&i>2){for(;i>138;i-=138)l(32754);i>2&&(l(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(l(a),--i;i>6;i-=6)l(8304);i>2&&(l(i-3<<5|8208),i=0)}for(;i--;)l(a);i=1,a=e[c]}return{c:t.subarray(0,n),n:r}},j=function(e,r){for(var t=0,n=0;n<r.length;++n)t+=e[n]*r[n];return t},P=function(e,r,t){var n=t.length,a=L(r+2);e[a]=255&n,e[a+1]=n>>8,e[a+2]=255^e[a],e[a+3]=255^e[a+1];for(var o=0;o<n;++o)e[a+o+4]=t[o];return 8*(a+4+n)},H=function(e,r,t,n,a,i,u,d,s,v,w){G(r,w++,t),++a[256];for(var h=B(a,15),y=h.t,m=h.l,p=B(i,15),g=p.t,q=p.l,x=K(y),E=x.c,U=x.n,C=K(g),L=C.c,T=C.n,O=new o(19),D=0;D<E.length;++D)++O[31&E[D]];for(D=0;D<L.length;++D)++O[31&L[D]];for(var F=B(O,7),H=F.t,J=F.l,N=19;N>4&&!H[f[N-1]];--N);var z,V,$,I,Q=v+5<<3,W=j(a,S)+j(i,A)+u,X=j(a,y)+j(i,g)+u+14+3*N+j(O,H)+2*O[16]+3*O[17]+7*O[18];if(s>=0&&Q<=W&&Q<=X)return P(r,w,e.subarray(s,s+v));if(G(r,w,1+(X<W)),w+=2,X<W){z=b(y,m,0),V=y,$=b(g,q,0),I=g;var Y=b(H,J,0);G(r,w,U-257),G(r,w+5,T-1),G(r,w+10,N-4),w+=14;for(D=0;D<N;++D)G(r,w+3*D,H[f[D]]);w+=3*N;for(var Z=[E,L],_=0;_<2;++_){var ee=Z[_];for(D=0;D<ee.length;++D){var re=31&ee[D];G(r,w,Y[re]),w+=H[re],re>15&&(G(r,w,ee[D]>>5&127),w+=ee[D]>>12)}}}else z=k,V=S,$=M,I=A;for(D=0;D<d;++D){var te=n[D];if(te>255){R(r,w,z[(re=te>>18&31)+257]),w+=V[re+257],re>7&&(G(r,w,te>>23&31),w+=l[re]);var ne=31&te;R(r,w,$[ne]),w+=I[ne],ne>3&&(R(r,w,te>>5&8191),w+=c[ne])}else R(r,w,z[te]),w+=V[te]}return R(r,w,z[256]),w+V[256]},J=new i([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),N=new a(0),z=function(e,r,t,n,f){if(!f&&(f={l:1},r.dictionary)){var u=r.dictionary.subarray(-32768),d=new a(u.length+e.length);d.set(u),d.set(e,u.length),e=d,f.w=u.length}return function(e,r,t,n,f,u){var d=u.z||e.length,s=new a(n+d+5*(1+Math.ceil(d/7e3))+f),w=s.subarray(n,s.length-f),h=u.l,m=7&(u.r||0);if(r){m&&(w[0]=u.r>>3);for(var p=J[r-1],g=p>>13,b=8191&p,S=(1<<t)-1,A=u.p||new o(32768),k=u.h||new o(S+1),q=Math.ceil(t/3),M=2*q,x=function(r){return(e[r]^e[r+1]<<q^e[r+2]<<M)&S},E=new i(25e3),U=new o(288),C=new o(32),O=0,D=0,G=u.i||0,R=0,B=u.w||0,F=0;G+2<d;++G){var K=x(G),j=32767&G,N=k[K];if(A[j]=N,k[K]=j,B<=G){var z=d-G;if((O>7e3||R>24576)&&(z>423||!h)){m=H(e,w,0,E,U,C,D,R,F,G-F,m),R=O=D=0,F=G;for(var V=0;V<286;++V)U[V]=0;for(V=0;V<30;++V)C[V]=0}var $=2,I=0,Q=b,W=j-N&32767;if(z>2&&K==x(G-W))for(var X=Math.min(g,z)-1,Y=Math.min(32767,G),Z=Math.min(258,z);W<=Y&&--Q&&j!=N;){if(e[G+$]==e[G+$-W]){for(var _=0;_<Z&&e[G+_]==e[G+_-W];++_);if(_>$){if($=_,I=W,_>X)break;var ee=Math.min(W,_-2),re=0;for(V=0;V<ee;++V){var te=G-W+V&32767,ne=te-A[te]&32767;ne>re&&(re=ne,N=te)}}}W+=(j=N)-(N=A[j])&32767}if(I){E[R++]=268435456|v[$]<<18|y[I];var ae=31&v[$],oe=31&y[I];D+=l[ae]+c[oe],++U[257+ae],++C[oe],B=G+$,++O}else E[R++]=e[G],++U[e[G]]}}for(G=Math.max(G,B);G<d;++G)E[R++]=e[G],++U[e[G]];m=H(e,w,h,E,U,C,D,R,F,G-F,m),h||(u.r=7&m|w[m/8|0]<<3,m-=7,u.h=k,u.p=A,u.i=G,u.w=B)}else{for(G=u.w||0;G<d+h;G+=65535){var ie=G+65535;ie>=d&&(w[m/8|0]=h,ie=d),m=P(w,m+1,e.subarray(G,ie))}u.i=d}return T(s,0,n+L(m)+f)}(e,null==r.level?6:r.level,null==r.mem?f.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):20:12+r.mem,t,n,f)};function V(e,r){return z(e,r||{},0,0)}function $(e,r){return function(e,r,t,n){var o=e.length;if(!o||r.f&&!r.l)return t||new a(0);var i=!t,u=i||2!=r.i,d=r.i;i&&(t=new a(3*o));var v=function(e){var r=t.length;if(e>r){var n=new a(Math.max(2*r,e));n.set(t),t=n}},w=r.f||0,y=r.p||0,m=r.b||0,p=r.l,g=r.d,S=r.m,A=r.n,k=8*o;do{if(!p){w=U(e,y,1);var M=U(e,y+1,3);if(y+=3,!M){var O=e[(z=L(y)+4)-4]|e[z-3]<<8,G=z+O;if(G>o){d&&D(0);break}u&&v(m+O),t.set(e.subarray(z,G),m),r.b=m+=O,r.p=y=8*G,r.f=w;continue}if(1==M)p=q,g=x,S=9,A=5;else if(2==M){var R=U(e,y,31)+257,B=U(e,y+10,15)+4,F=R+U(e,y+5,31)+1;y+=14;for(var K=new a(F),j=new a(19),P=0;P<B;++P)j[f[P]]=U(e,y+3*P,7);y+=3*B;var H=E(j),J=(1<<H)-1,N=b(j,H,1);for(P=0;P<F;){var z,V=N[U(e,y,J)];if(y+=15&V,(z=V>>4)<16)K[P++]=z;else{var $=0,I=0;for(16==z?(I=3+U(e,y,3),y+=2,$=K[P-1]):17==z?(I=3+U(e,y,7),y+=3):18==z&&(I=11+U(e,y,127),y+=7);I--;)K[P++]=$}}var Q=K.subarray(0,R),W=K.subarray(R);S=E(Q),A=E(W),p=b(Q,S,1),g=b(W,A,1)}else D(1);if(y>k){d&&D(0);break}}u&&v(m+131072);for(var X=(1<<S)-1,Y=(1<<A)-1,Z=y;;Z=y){var _=($=p[C(e,y)&X])>>4;if((y+=15&$)>k){d&&D(0);break}if($||D(2),_<256)t[m++]=_;else{if(256==_){Z=y,p=null;break}var ee=_-254;if(_>264){var re=l[P=_-257];ee=U(e,y,(1<<re)-1)+s[P],y+=re}var te=g[C(e,y)&Y],ne=te>>4;if(te||D(3),y+=15&te,W=h[ne],ne>3&&(re=c[ne],W+=C(e,y)&(1<<re)-1,y+=re),y>k){d&&D(0);break}u&&v(m+131072);var ae=m+ee;if(m<W){var oe=0-W,ie=Math.min(W,ae);for(oe+m<0&&D(3);m<ie;++m)t[m]=n[oe+m]}for(;m<ae;++m)t[m]=t[m-W]}}r.l=p,r.p=Z,r.b=m,r.f=w,p&&(w=1,r.m=S,r.d=g,r.n=A)}while(!w);return m!=t.length&&i?T(t,0,m):t.subarray(0,m)}(e,{i:2},r,r)}var I="undefined"!=typeof TextDecoder&&new TextDecoder;try{I.decode(N,{stream:!0})}catch(e){}const Q=new TextEncoder,W=new TextDecoder;async function X(e,r){let t=Q.encode(e),n=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveKey"]);return await window.crypto.subtle.deriveKey({name:"PBKDF2",hash:"SHA-512",salt:r,iterations:1e3},n,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function Y(e,r){let t=n(e.data),a=n(e.iv),o=n(e.salt),i=e.comp,l=await X(r,o),c=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:a},l,t);return i&&(c=$(new Uint8Array(c))),W.decode(c)}let origContentOfGetSelfMoudle=window.origContentOfGetSelfMoudle;async function Z(){let e="";return e=origContentOfGetSelfMoudle?function(e){let r=n(e);return r=$(r),(new TextDecoder).decode(r)}(origContentOfGetSelfMoudle):await fetch(window.location.href).then((e=>e.text())),e=e.replace(/ origContentOfGetSelfMoudle\s*=window\.origContentOfGetSelfMoudle\s*;/m,` origContentOfGetSelfMoudle = "${function(e){let r=(new TextEncoder).encode(e);return r=V(r,{level:9}),t(r)}(e)}";`),e}function _(e){document.querySelector("#pwd").value="",document.querySelector("#pwd2").value="",document.querySelector("#pwd3").value="",document.querySelector("#file").value=null;let r=document.querySelector("#popup");r.querySelectorAll(".panel").forEach((r=>{r.classList.toggle("hide",e!==r.id)})),r.classList.toggle("hide",!1)}function ee(){document.querySelector("#popup").classList.toggle("hide",!0)}let re="save";function te(e,r,t){let n=URL.createObjectURL(new Blob([r],{type:t})),a=document.createElement("a");a.href=n,a.download=e,a.click(),setTimeout((()=>{URL.revokeObjectURL(n)}),100)}document.querySelector("#btn-archive").addEventListener("click",(()=>{re="archive",_("panel1")})),document.querySelector("#btn-save").addEventListener("click",(()=>{re="save",_("panel1")})),document.querySelector("#btn-load").addEventListener("click",(()=>{_("panel2")})),document.querySelector("#btn-encrypt").addEventListener("click",(async()=>{let e=document.querySelector("#text").value,r=document.querySelector("#pwd").value,n=document.querySelector("#pwd2").value;if(r.length<4)alert("密碼至少四位");else if(r===n)try{let n=await async function(e,r){let n=new Uint8Array(16),a=new Uint8Array(12);window.crypto.getRandomValues(n),window.crypto.getRandomValues(a);let o=await X(r,n),i=Q.encode(e),l=V(i,{level:9}),c=l.length<i.length,f=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:a},o,c?l:i);return{alg:"PBKDF2-HMAC-SHA512 (1000 iterations, with salt) -> AES-256-GCM (128-bit tag, no AAD)",comp:c,iv:t(a),salt:t(n),data:t(f)}}(e,r);switch(re){case"archive":let e=await Z();e=e.replace(/window.cipher = null;/m,`window.cipher = ${JSON.stringify(n)};`),te("cipher.html",e,"text/html");break;case"save":te("cipher.json",JSON.stringify(n),"application/json");break;default:throw"bad proc"}ee()}catch(e){alert("發生錯誤："+e)}else alert("兩次輸入的密碼不同")})),document.querySelector("#btn-decrypt").addEventListener("click",(async()=>{try{let e=document.querySelector("#pwd3").value,r=document.querySelector("#file").files[0],t=await new Promise((e=>{let t=new FileReader;t.onload=()=>{e(t.result)},t.readAsText(r)})),n=JSON.parse(t),a=await Y(n,e);document.querySelector("#text").value=a}catch(e){console.log(e),document.querySelector("#text").value="解密錯誤"}ee()})),document.querySelectorAll(".cancel").forEach((e=>{e.addEventListener("click",(()=>{ee()}))})),window.cipher&&_("panel3"),document.querySelector("#btn-decrypt2").addEventListener("click",(async()=>{try{let e=document.querySelector("#pwd4").value,r=window.cipher,t=await Y(r,e);document.querySelector("#text").value=t,ee()}catch(e){document.querySelector("#dec-log").textContent="解密錯誤",console.log(e)}}))}();
</script>
</body>
</html>